<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ILMNEXUS - Exam Interface</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 80px 20px 40px;
        }
        
        /* Header Styles */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: #2E73FF;
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .logo-text {
            font-size: 22px;
            font-weight: 800;
            color: #2E73FF;
        }
        
        .timer {
            background: #ffe8d1;
            color: #E07C14;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 18px;
            min-width: 140px;
            text-align: center;
        }
        
        .timer.warning {
            background: #ffdfdf;
            color: #ff3860;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .student-info {
            text-align: right;
        }
        
        .student-info .name {
            font-weight: 700;
            color: #2E73FF;
        }
        
        .student-info .matric {
            font-size: 14px;
            color: #777;
        }
        
        /* Exam Content Styles */
        .exam-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
        }
        
        .question-number {
            font-size: 18px;
            font-weight: 700;
            color: #2E73FF;
        }
        
        .question-type {
            background: #E07C14;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .question-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #333;
        }
        
        /* MCQ Options */
        .options {
            margin-bottom: 30px;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #eee;
            border-radius: 12px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option:hover {
            border-color: #2E73FF;
            background: #f8faff;
        }
        
        .option input[type="radio"] {
            display: none;
        }
        
        .option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            width: 100%;
        }
        
        .custom-radio {
            width: 24px;
            height: 24px;
            border: 2px solid #ddd;
            border-radius: 50%;
            margin-right: 15px;
            position: relative;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        
        .option input[type="radio"]:checked + label .custom-radio {
            border-color: #2E73FF;
            background: #2E73FF;
        }
        
        .option input[type="radio"]:checked + label .custom-radio::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
        }
        
        .option-text {
            font-size: 16px;
            color: #555;
        }
        
        /* Essay Question */
        .essay-container {
            margin-bottom: 30px;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: #2E73FF;
            box-shadow: 0 0 0 3px rgba(46, 115, 255, 0.2);
        }
        
        .word-counter {
            text-align: right;
            color: #777;
            font-size: 14px;
            margin-top: 10px;
        }
        
        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }
        
        .nav-btn {
            background: #2E73FF;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-btn:hover {
            background: #1c5de5;
            transform: translateY(-2px);
        }
        
        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .nav-btn.prev {
            background: #6c757d;
        }
        
        .nav-btn.prev:hover {
            background: #5a6268;
        }
        
        .jump-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .jump-label {
            font-size: 14px;
            color: #777;
        }
        
        .jump-select {
            padding: 10px;
            border: 2px solid #eee;
            border-radius: 8px;
            background: white;
            cursor: pointer;
        }
        
        .submit-btn {
            background: #E07C14;
        }
        
        .submit-btn:hover {
            background: #c5690d;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            text-align: center;
        }
        
        .modal-title {
            font-size: 24px;
            color: #2E73FF;
            margin-bottom: 20px;
        }
        
        .modal-text {
            font-size: 18px;
            color: #555;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .modal-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-btn.cancel {
            background: #f1f1f1;
            color: #333;
        }
        
        .modal-btn.cancel:hover {
            background: #ddd;
        }
        
        .modal-btn.confirm {
            background: #23d160;
            color: white;
        }
        
        .modal-btn.confirm:hover {
            background: #20bc58;
        }
        
        /* Result Page Styles */
        .result-header {
            background: linear-gradient(135deg, #2E73FF 0%, #1c5de5 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 20px 20px 0 0;
        }
        
        .result-title {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .result-subtitle {
            font-size: 18px;
            opacity: 0.9;
        }
        
        .certificate-card {
            border: 2px solid #2E73FF;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .section {
            padding: 25px;
            border-bottom: 1px solid #eee;
        }
        
        .section:last-child {
            border-bottom: none;
        }
        
        .section-title {
            font-size: 20px;
            color: #2E73FF;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #E07C14;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .info-item {
            margin-bottom: 15px;
        }
        
        .info-label {
            font-size: 14px;
            color: #777;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 16px;
            color: #333;
            font-weight: 500;
        }
        
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            text-align: center;
        }
        
        .performance-item {
            padding: 20px;
            border-radius: 12px;
            background: #f8f9fa;
        }
        
        .performance-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .performance-label {
            font-size: 14px;
            color: #777;
        }
        
        .correct .performance-value {
            color: #23d160;
        }
        
        .wrong .performance-value {
            color: #ff3860;
        }
        
        .not-attempted .performance-value {
            color: #ffdd57;
        }
        
        .negative .performance-value {
            color: #ff3860;
        }
        
        .total-score {
            text-align: center;
            padding: 30px;
            background: #f8faff;
            border-radius: 0 0 20px 20px;
        }
        
        .score-value {
            font-size: 48px;
            font-weight: 800;
            color: #2E73FF;
            margin-bottom: 10px;
        }
        
        .score-label {
            font-size: 18px;
            color: #777;
        }
        
        .download-btn {
            background: #E07C14;
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .download-btn:hover {
            background: #c5690d;
            transform: translateY(-2px);
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            header {
                flex-wrap: wrap;
                padding: 10px 15px;
            }
            
            .logo {
                order: 1;
                width: 50%;
            }
            
            .timer {
                order: 3;
                width: 100%;
                margin-top: 10px;
                min-width: auto;
            }
            
            .student-info {
                order: 2;
                width: 50%;
                text-align: right;
            }
            
            .container {
                padding: 120px 15px 30px;
            }
            
            .exam-card {
                padding: 20px;
            }
            
            .navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .jump-container {
                order: 3;
            }
            
            .performance-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .logo-text {
                font-size: 18px;
            }
            
            .timer {
                font-size: 16px;
            }
            
            .student-info .name {
                font-size: 14px;
            }
            
            .student-info .matric {
                font-size: 12px;
            }
            
            .question-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .modal-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .performance-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .hidden {
            display: none;
        }
        
        .progress-bar {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: #2E73FF;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Exam Interface -->
    <div id="exam-interface">
        <header>
            <div class="logo">
                <div class="logo-icon">IX</div>
                <div class="logo-text">ILMXAM</div>
            </div>
            
            <div class="timer" id="timer">40:00</div>
            
            <div class="student-info">
                <div class="name" id="student-name">Loading...</div>
                <div class="matric" id="student-matric">Loading...</div>
            </div>
        </header>
        
        <div class="container">
            <div class="progress-bar">
                <div class="progress" id="progress-bar" style="width: 4%;"></div>
            </div>
            
            <div class="exam-card">
                <div class="question-header">
                    <div class="question-number">Question <span id="current-q">1</span> of 25</div>
                    <div class="question-type" id="question-type">MCQ</div>
                </div>
                
                <div class="question-text" id="question-text">
                    Loading question...
                </div>
                
                <div class="options" id="mcq-options">
                    <!-- Options will be populated by JavaScript -->
                </div>
                
                <div class="essay-container hidden" id="essay-container">
                    <textarea id="essay-answer" placeholder="Type your answer here..."></textarea>
                    <div class="word-counter">Words: <span id="word-count">0</span></div>
                </div>
                
                <div class="navigation">
                    <button class="nav-btn prev" id="prev-btn" disabled>
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    
                    <div class="jump-container">
                        <span class="jump-label">Jump to:</span>
                        <select class="jump-select" id="jump-select">
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    
                    <button class="nav-btn next" id="next-btn">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <div class="navigation">
                    <button class="nav-btn submit-btn" id="submit-btn">
                        <i class="fas fa-paper-plane"></i> Submit Exam
                    </button>
                </div>
            </div>
        </div>
        
        <div class="modal-overlay" id="modal-overlay">
            <div class="modal">
                <h2 class="modal-title">Confirm Submission</h2>
                <p class="modal-text">Are you sure you want to submit your exam? You will not be able to make changes after submission.</p>
                
                <div class="modal-buttons">
                    <button class="modal-btn cancel" id="cancel-btn">Cancel</button>
                    <button class="modal-btn confirm" id="confirm-btn">Yes, Submit</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Result Page -->
    <div id="result-page" class="hidden">
        <div class="container">
            <div class="logo" style="justify-content: center; margin-bottom: 30px;">
                <div class="logo-icon">IX</div>
                <div class="logo-text">ILMXAM</div>
            </div>
            
            <div class="certificate-card">
                <div class="result-header">
                    <h1 class="result-title">Exam Results</h1>
                    <p class="result-subtitle">Congratulations on completing your exam</p>
                </div>
                
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-user-graduate"></i> Student Details</h2>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Full Name</div>
                            <div class="info-value" id="result-name">John David Anderson</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Matric Number</div>
                            <div class="info-value" id="result-matric">ILM2024025</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Course</div>
                            <div class="info-value" id="result-course">Computer Science</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Father's Name</div>
                            <div class="info-value" id="result-father">Robert Anderson</div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-clock"></i> Exam Details</h2>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Exam Title</div>
                            <div class="info-value">JavaScript Fundamentals</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Start Time</div>
                            <div class="info-value" id="start-time">Loading...</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">End Time</div>
                            <div class="info-value" id="end-time">Loading...</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Duration</div>
                            <div class="info-value">40 minutes</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Attempts</div>
                            <div class="info-value">1/2</div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-chart-pie"></i> Performance Breakdown</h2>
                    
                    <div class="performance-grid">
                        <div class="performance-item correct">
                            <div class="performance-value" id="correct-answers">0</div>
                            <div class="performance-label">Correct Answers</div>
                        </div>
                        
                        <div class="performance-item wrong">
                            <div class="performance-value" id="wrong-answers">0</div>
                            <div class="performance-label">Wrong Answers</div>
                        </div>
                        
                        <div class="performance-item not-attempted">
                            <div class="performance-value" id="not-attempted">0</div>
                            <div class="performance-label">Not Attempted</div>
                        </div>
                        
                        <div class="performance-item negative">
                            <div class="performance-value" id="negative-marks">0</div>
                            <div class="performance-label">Negative Marks</div>
                        </div>
                    </div>
                </div>
                
                <div class="total-score">
                    <div class="score-value" id="score-percentage">0%</div>
                    <div class="score-label">Total Score: <span id="score-value">0</span> out of 40</div>
                    
                    <button class="download-btn" id="download-btn">
                        <i class="fas fa-download"></i> Download Results as PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAi_IyKB8Rkb0CpM_lBlwgdpsZxsZT_MdY",
            authDomain: "ilmxam.firebaseapp.com",
            projectId: "ilmxam",
            storageBucket: "ilmxam.firebasestorage.app",
            messagingSenderId: "499914637135",
            appId: "1:499914637135:web:8622a39105d0706be7cf3a"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // DOM Elements
        const examInterface = document.getElementById('exam-interface');
        const resultPage = document.getElementById('result-page');
        const timerElement = document.getElementById('timer');
        const currentQuestionElement = document.getElementById('current-q');
        const questionTypeElement = document.getElementById('question-type');
        const questionTextElement = document.getElementById('question-text');
        const mcqOptionsElement = document.getElementById('mcq-options');
        const essayContainerElement = document.getElementById('essay-container');
        const essayAnswerElement = document.getElementById('essay-answer');
        const wordCountElement = document.getElementById('word-count');
        const prevButton = document.getElementById('prev-btn');
        const nextButton = document.getElementById('next-btn');
        const jumpSelect = document.getElementById('jump-select');
        const submitButton = document.getElementById('submit-btn');
        const modalOverlay = document.getElementById('modal-overlay');
        const cancelButton = document.getElementById('cancel-btn');
        const confirmButton = document.getElementById('confirm-btn');
        const downloadButton = document.getElementById('download-btn');
        const progressBar = document.getElementById('progress-bar');
        const studentNameElement = document.getElementById('student-name');
        const studentMatricElement = document.getElementById('student-matric');
        
        // Result page elements
        const resultNameElement = document.getElementById('result-name');
        const resultMatricElement = document.getElementById('result-matric');
        const resultCourseElement = document.getElementById('result-course');
        const resultFatherElement = document.getElementById('result-father');
        const startTimeElement = document.getElementById('start-time');
        const endTimeElement = document.getElementById('end-time');
        const correctAnswersElement = document.getElementById('correct-answers');
        const wrongAnswersElement = document.getElementById('wrong-answers');
        const notAttemptedElement = document.getElementById('not-attempted');
        const negativeMarksElement = document.getElementById('negative-marks');
        const scorePercentageElement = document.getElementById('score-percentage');
        const scoreValueElement = document.getElementById('score-value');
        
        // Exam state
        let currentQuestion = 1;
        let totalQuestions = 25;
        let timeLeft = 40 * 60; // 40 minutes in seconds
        let timerInterval;
        let startTime;
        let userAnswers = {};
        let examData = {};
        
        // Sample questions data (20 MCQ + 5 Essay)
        const questions = [
            // MCQ Questions (1-20)
            {
                id: 1,
                type: "MCQ",
                text: "Which of the following best describes the concept of 'variable hoisting' in JavaScript?",
                options: [
                    "Variables are moved to the top of their scope during compilation",
                    "Variables are automatically assigned a value of undefined",
                    "Variables can be accessed before they are declared",
                    "All of the above"
                ],
                correctAnswer: "D",
                marks: 1
            },
            {
                id: 2,
                type: "MCQ",
                text: "What does CSS stand for?",
                options: [
                    "Computer Style Sheets",
                    "Creative Style System",
                    "Cascading Style Sheets",
                    "Colorful Style Sheets"
                ],
                correctAnswer: "C",
                marks: 1
            },
            {
                id: 3,
                type: "MCQ",
                text: "Which HTML tag is used to define an internal style sheet?",
                options: [
                    "<css>",
                    "<script>",
                    "<style>",
                    "<link>"
                ],
                correctAnswer: "C",
                marks: 1
            },
            {
                id: 4,
                type: "MCQ",
                text: "Which property is used to change the background color?",
                options: [
                    "color",
                    "bgcolor",
                    "background-color",
                    "bg-color"
                ],
                correctAnswer: "C",
                marks: 1
            },
            {
                id: 5,
                type: "MCQ",
                text: "How do you insert a comment in a CSS file?",
                options: [
                    "// this is a comment //",
                    "/* this is a comment */",
                    "' this is a comment",
                    "// this is a comment"
                ],
                correctAnswer: "B",
                marks: 1
            },
            {
                id: 6,
                type: "MCQ",
                text: "Which property is used to change the font of an element?",
                options: [
                    "font-style",
                    "font-weight",
                    "font-family",
                    "text-font"
                ],
                correctAnswer: "C",
                marks: 1
            },
            {
                id: 7,
                type: "MCQ",
                text: "How do you make each word in a text start with a capital letter?",
                options: [
                    "text-transform: capitalize",
                    "text-style: capital",
                    "transform: capitalize",
                    "font-style: capital"
                ],
                correctAnswer: "A",
                marks: 1
            },
            {
                id: 8,
                type: "MCQ",
                text: "Which property is used to change the left margin of an element?",
                options: [
                    "margin-left",
                    "padding-left",
                    "indent",
                    "left-margin"
                ],
                correctAnswer: "A",
                marks: 1
            },
            {
                id: 9,
                type: "MCQ",
                text: "What is the correct HTML for referring to an external style sheet?",
                options: [
                    "<stylesheet>mystyle.css</stylesheet>",
                    "<style src=\"mystyle.css\">",
                    "<link rel=\"stylesheet\" type=\"text/css\" href=\"mystyle.css\">",
                    "<css>mystyle.css</css>"
                ],
                correctAnswer: "C",
                marks: 1
            },
            {
                id: 10,
                type: "MCQ",
                text: "Which is the correct CSS syntax?",
                options: [
                    "body {color: black;}",
                    "{body:color=black;}",
                    "body:color=black;",
                    "{body;color:black;}"
                ],
                correctAnswer: "A",
                marks: 1
            },
            {
                id: 11,
                type: "MCQ",
                text: "How do you add a background color for all <h1> elements?",
                options: [
                    "h1.all {background-color:#FFFFFF;}",
                    "h1 {background-color:#FFFFFF;}",
                    "all.h1 {background-color:#FFFFFF;}",
                    "h1.all bgcolor=#FFFFFF;"
                ],
                correctAnswer: "B",
                marks: 1
            },
            {
                id: 12,
                type: "MCQ",
                text: "Which CSS property controls the text size?",
                options: [
                    "font-style",
                    "text-size",
                    "font-size",
                    "text-style"
                ],
                correctAnswer: "C",
                marks: 1
            },
            {
                id: 13,
                type: "MCQ",
                text: "What is the correct HTML for making a checkbox?",
                options: [
                    "<input type=\"check\">",
                    "<check>",
                    "<checkbox>",
                    "<input type=\"checkbox\">"
                ],
                correctAnswer: "D",
                marks: 1
            },
            {
                id: 14,
                type: "MCQ",
                text: "What is the correct HTML for making a text input field?",
                options: [
                    "<input type=\"text\">",
                    "<textfield>",
                    "<textinput type=\"text\">",
                    "<input type=\"textfield\">"
                ],
                correctAnswer: "A",
                marks: 1
            },
            {
                id: 15,
                type: "MCQ",
                text: "What is the correct HTML for making a drop-down list?",
                options: [
                    "<list>",
                    "<input type=\"list\">",
                    "<select>",
                    "<input type=\"dropdown\">"
                ],
                correctAnswer: "C",
                marks: 1
            },
            {
                id: 16,
                type: "MCQ",
                text: "What is the correct HTML for making a text area?",
                options: [
                    "<input type=\"textbox\">",
                    "<input type=\"textarea\">",
                    "<textarea>",
                    "<text area>"
                ],
                correctAnswer: "C",
                marks: 1
            },
            {
                id: 17,
                type: "MCQ",
                text: "What is the correct HTML for inserting an image?",
                options: [
                    "<image src=\"image.gif\" alt=\"MyImage\">",
                    "<img href=\"image.gif\" alt=\"MyImage\">",
                    "<img src=\"image.gif\" alt=\"MyImage\">",
                    "<img alt=\"MyImage\">image.gif</img>"
                ],
                correctAnswer: "C",
                marks: 1
            },
            {
                id: 18,
                type: "MCQ",
                text: "What is the correct HTML for inserting a background image?",
                options: [
                    "<body style=\"background-image:url(background.gif)\">",
                    "<background img=\"background.gif\">",
                    "<body bg=\"background.gif\">",
                    "<body background=\"background.gif\">"
                ],
                correctAnswer: "A",
                marks: 1
            },
            {
                id: 19,
                type: "MCQ",
                text: "Which of these elements are all <table> elements?",
                options: [
                    "<table><head><tfoot>",
                    "<table><tr><td>",
                    "<table><tr><tt>",
                    "<thead><body><tr>"
                ],
                correctAnswer: "B",
                marks: 1
            },
            {
                id: 20,
                type: "MCQ",
                text: "How can you make a numbered list?",
                options: [
                    "<list>",
                    "<ol>",
                    "<dl>",
                    "<ul>"
                ],
                correctAnswer: "B",
                marks: 1
            },
            
            // Essay Questions (21-25)
            {
                id: 21,
                type: "Essay",
                text: "Explain the concept of closures in JavaScript and provide a practical example of where they might be useful.",
                marks: 4
            },
            {
                id: 22,
                type: "Essay",
                text: "Describe the box model in CSS and how it affects layout and design of web pages.",
                marks: 4
            },
            {
                id: 23,
                type: "Essay",
                text: "Explain the difference between let, const, and var in JavaScript with examples.",
                marks: 4
            },
            {
                id: 24,
                type: "Essay",
                text: "Discuss the importance of responsive web design and describe three techniques for creating responsive layouts.",
                marks: 4
            },
            {
                id: 25,
                type: "Essay",
                text: "Explain how the JavaScript event loop works and why it's important for asynchronous programming.",
                marks: 4
            }
        ];
        
        // Initialize the exam
        function initExam() {
            // Get user data from session storage
            const userData = JSON.parse(sessionStorage.getItem('user') || '{}');
            
            // Set student info
            studentNameElement.textContent = userData.fullName || "Student Name";
            studentMatricElement.textContent = `${userData.matricNumber || "MATRIC123"} | ${userData.course || "Course"}`;
            
            // Record start time
            startTime = new Date();
            startTimeElement.textContent = startTime.toLocaleString();
            
            // Start the timer
            startTimer();
            
            // Load the first question
            loadQuestion(currentQuestion);
            
            // Populate the jump select
            populateJumpSelect();
            
            // Set up event listeners
            setupEventListeners();
        }
        
        // Start the countdown timer
        function startTimer() {
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitExam();
                } else if (timeLeft <= 300) { // 5 minutes left
                    timerElement.classList.add('warning');
                }
                
                updateTimerDisplay();
            }, 1000);
        }
        
        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Load a question
        function loadQuestion(number) {
            const question = questions[number - 1];
            
            // Update UI
            currentQuestionElement.textContent = number;
            questionTextElement.textContent = question.text;
            questionTypeElement.textContent = question.type;
            
            // Update progress bar
            progressBar.style.width = `${(number / totalQuestions) * 100}%`;
            
            // Show appropriate input based on question type
            if (question.type === "MCQ") {
                mcqOptionsElement.classList.remove('hidden');
                essayContainerElement.classList.add('hidden');
                
                // Clear previous options
                mcqOptionsElement.innerHTML = '';
                
                // Create new options
                const optionLetters = ['A', 'B', 'C', 'D'];
                question.options.forEach((option, index) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option';
                    
                    optionElement.innerHTML = `
                        <input type="radio" name="answer" id="option${optionLetters[index]}" value="${optionLetters[index]}">
                        <label for="option${optionLetters[index]}">
                            <span class="custom-radio"></span>
                            <span class="option-text">${option}</span>
                        </label>
                    `;
                    
                    mcqOptionsElement.appendChild(optionElement);
                });
                
                // Check if user has already answered this question
                if (userAnswers[number]) {
                    document.querySelector(`input[name="answer"][value="${userAnswers[number]}"]`).checked = true;
                }
            } else {
                mcqOptionsElement.classList.add('hidden');
                essayContainerElement.classList.remove('hidden');
                
                // Check if user has already answered this question
                if (userAnswers[number]) {
                    essayAnswerElement.value = userAnswers[number];
                    updateWordCount();
                } else {
                    essayAnswerElement.value = '';
                    wordCountElement.textContent = '0';
                }
            }
            
            // Update navigation buttons
            prevButton.disabled = number === 1;
            nextButton.disabled = number === totalQuestions;
            
            // Update jump select
            jumpSelect.value = number;
        }
        
        // Update word count for essay questions
        function updateWordCount() {
            const text = essayAnswerElement.value;
            const wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            wordCountElement.textContent = wordCount;
        }
        
        // Populate the jump select dropdown
        function populateJumpSelect() {
            jumpSelect.innerHTML = '';
            
            for (let i = 1; i <= totalQuestions; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Question ${i}`;
                jumpSelect.appendChild(option);
            }
        }
        
        // Save the current answer
        function saveAnswer() {
            if (questions[currentQuestion - 1].type === "MCQ") {
                const selectedOption = document.querySelector('input[name="answer"]:checked');
                if (selectedOption) {
                    userAnswers[currentQuestion] = selectedOption.value;
                }
            } else {
                if (essayAnswerElement.value.trim() !== '') {
                    userAnswers[currentQuestion] = essayAnswerElement.value;
                }
            }
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Navigation buttons
            prevButton.addEventListener('click', () => {
                saveAnswer();
                if (currentQuestion > 1) {
                    currentQuestion--;
                    loadQuestion(currentQuestion);
                }
            });
            
            nextButton.addEventListener('click', () => {
                saveAnswer();
                if (currentQuestion < totalQuestions) {
                    currentQuestion++;
                    loadQuestion(currentQuestion);
                }
            });
            
            // Jump to question
            jumpSelect.addEventListener('change', () => {
                saveAnswer();
                currentQuestion = parseInt(jumpSelect.value);
                loadQuestion(currentQuestion);
            });
            
            // Essay word count
            essayAnswerElement.addEventListener('input', updateWordCount);
            
            // Submit exam
            submitButton.addEventListener('click', () => {
                modalOverlay.classList.add('active');
            });
            
            // Modal buttons
            cancelButton.addEventListener('click', () => {
                modalOverlay.classList.remove('active');
            });
            
            confirmButton.addEventListener('click', () => {
                modalOverlay.classList.remove('active');
                submitExam();
            });
            
            // Download results
            downloadButton.addEventListener('click', downloadResults);
        }
        
        // Calculate results
        function calculateResults() {
            let correctCount = 0;
            let wrongCount = 0;
            let notAttemptedCount = 0;
            let negativeMarks = 0;
            let totalScore = 0;
            
            for (let i = 1; i <= totalQuestions; i++) {
                const question = questions[i - 1];
                
                if (!userAnswers[i]) {
                    notAttemptedCount++;
                    continue;
                }
                
                if (question.type === "MCQ") {
                    if (userAnswers[i] === question.correctAnswer) {
                        correctCount++;
                        totalScore += question.marks;
                    } else {
                        wrongCount++;
                        negativeMarks += 0.25;
                        totalScore -= 0.25;
                    }
                } else {
                    // For essay questions, we'll assign a random score between 60-100% of max marks
                    // In a real app, this would be graded by a teacher or using an algorithm
                    const essayScore = question.marks * (0.6 + Math.random() * 0.4);
                    totalScore += essayScore;
                }
            }
            
            return {
                correctCount,
                wrongCount,
                notAttemptedCount,
                negativeMarks: negativeMarks.toFixed(2),
                totalScore: Math.max(0, totalScore.toFixed(2)), // Ensure score is not negative
                percentage: ((Math.max(0, totalScore) / 40) * 100).toFixed(2)
            };
        }
        
        // Submit the exam
        function submitExam() {
            clearInterval(timerInterval);
            saveAnswer();
            
            // Calculate results
            const results = calculateResults();
            
            // Record end time
            const endTime = new Date();
            endTimeElement.textContent = endTime.toLocaleString();
            
            // Get user data from session storage
            const userData = JSON.parse(sessionStorage.getItem('user') || '{}');
            
            // Update result page with user data
            resultNameElement.textContent = userData.fullName || "Student Name";
            resultMatricElement.textContent = userData.matricNumber || "MATRIC123";
            resultCourseElement.textContent = userData.course || "Course";
            resultFatherElement.textContent = userData.fatherName || "Father's Name";
            
            // Update result page with performance data
            correctAnswersElement.textContent = results.correctCount;
            wrongAnswersElement.textContent = results.wrongCount;
            notAttemptedElement.textContent = results.notAttemptedCount;
            negativeMarksElement.textContent = results.negativeMarks;
            scoreValueElement.textContent = `${results.totalScore} / 40`;
            scorePercentageElement.textContent = `${results.percentage}%`;
            
            // Prepare exam data for Firebase
            examData = {
                studentId: userData.matricNumber,
                studentName: userData.fullName,
                course: userData.course,
                startTime: startTime,
                endTime: endTime,
                answers: userAnswers,
                results: results,
                submittedAt: new Date()
            };
            
            // Save to Firebase (commented out for now)
            /*
            try {
                await db.collection('exam_submissions').add(examData);
                console.log("Exam results saved to Firebase");
            } catch (error) {
                console.error("Error saving exam results:", error);
            }
            */
            
            // Show result page
            examInterface.classList.add('hidden');
            resultPage.classList.remove('hidden');
        }
        
        // Download results as PDF
        function downloadResults() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add certificate content
            doc.setFontSize(24);
            doc.setTextColor(46, 115, 255);
            doc.text('ILMXAM - Exam Results', 105, 30, { align: 'center' });
            
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('Certificate of Completion', 105, 45, { align: 'center' });
            
            doc.setFontSize(12);
            doc.text(`This is to certify that ${examData.studentName} (${examData.studentId})`, 105, 60, { align: 'center' });
            doc.text(`has completed the exam with a score of ${examData.results.totalScore}/40 (${examData.results.percentage}%)`, 105, 70, { align: 'center' });
            
            // Add performance details
            doc.setFontSize(14);
            doc.setTextColor(46, 115, 255);
            doc.text('Performance Summary', 20, 90);
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text(`Correct Answers: ${examData.results.correctCount}`, 20, 100);
            doc.text(`Wrong Answers: ${examData.results.wrongCount}`, 20, 110);
            doc.text(`Not Attempted: ${examData.results.notAttemptedCount}`, 20, 120);
            doc.text(`Negative Marks: ${examData.results.negativeMarks}`, 20, 130);
            
            // Add exam details
            doc.setFontSize(14);
            doc.setTextColor(46, 115, 255);
            doc.text('Exam Details', 20, 150);
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text(`Start Time: ${examData.startTime.toLocaleString()}`, 20, 160);
            doc.text(`End Time: ${examData.endTime.toLocaleString()}`, 20, 170);
            doc.text(`Duration: 40 minutes`, 20, 180);
            
            // Save the PDF
            doc.save(`ILMXAM_Results_${examData.studentId}.pdf`);
        }
        
        // Initialize the exam when the page loads
        document.addEventListener('DOMContentLoaded', initExam);
    </script>
</body>
</html>